<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BioTrace</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #3a7bd5;
            --secondary-color: #00d2ff;
            --accent-color: #4fc3f7;
            --light-color: #f8f9fa;
            --dark-color: #2c3e50;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --border-radius: 10px;
            --box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Open Sans', sans-serif;
            line-height: 1.6;
            color: var(--dark-color);
            background-color: #f5f7fa;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
            position: relative;
        }

        h1 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-family: 'Roboto', sans-serif;
            font-weight: 700;
            font-size: 2.5rem;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            color: #6c757d;
            font-weight: 400;
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .model-info {
            background-color: var(--light-color);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            border-left: 5px solid var(--accent-color);
            display: flex;
            align-items: center;
        }

        .model-info i {
            font-size: 2rem;
            color: var(--primary-color);
            margin-right: 20px;
        }

        .model-info-content h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .model-info-content p {
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .input-section {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .input-group {
            margin-bottom: 20px;
            position: relative;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
            font-size: 0.95rem;
        }

        .input-group input[type="number"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: var(--transition);
            background-color: #f8fafc;
        }

        .input-group input[type="number"]:focus {
            border-color: var(--accent-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(79, 195, 247, 0.2);
            background-color: white;
        }

        .input-group .input-icon {
            position: absolute;
            right: 15px;
            top: 38px;
            color: #adb5bd;
        }

        .section-title {
            color: var(--primary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
        }

        .section-title i {
            margin-right: 10px;
            font-size: 1.1rem;
        }

        .button-group {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
        }

        button {
            padding: 14px 28px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .predict-btn {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            box-shadow: 0 4px 10px rgba(58, 123, 213, 0.3);
        }

        .predict-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(58, 123, 213, 0.4);
        }

        .reset-btn {
            background-color: white;
            color: var(--dark-color);
            border: 2px solid #e0e0e0;
        }

        .reset-btn:hover {
            background-color: #f8f9fa;
            border-color: var(--accent-color);
        }

        .fastq-btn {
            background-color: var(--success-color);
            color: white;
            box-shadow: 0 4px 10px rgba(40, 167, 69, 0.3);
        }

        .fastq-btn:hover {
            background-color: #218838;
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(40, 167, 69, 0.4);
        }

        .results-section {
            display: none;
            margin-top: 30px;
            padding: 30px;
            background-color: var(--light-color);
            border-radius: var(--border-radius);
            animation: fadeIn 0.5s ease-in-out;
            border-top: 5px solid var(--primary-color);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .prediction-label {
            font-size: 28px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .prediction-label i {
            font-size: 1.5rem;
        }

        .confidence {
            font-size: 18px;
            color: var(--dark-color);
            background-color: white;
            padding: 8px 15px;
            border-radius: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .confidence-value {
            font-weight: 700;
            color: var(--primary-color);
        }

        .probability-chart {
            height: 300px;
            margin-top: 30px;
        }

        .probability-bar {
            height: 40px;
            margin-bottom: 15px;
            background-color: #e9ecef;
            border-radius: 6px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }

        .probability-fill {
            height: 100%;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            border-radius: 6px;
            transition: width 0.7s ease-in-out;
            display: flex;
            align-items: center;
            padding-left: 15px;
            color: white;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .location-info {
            margin-top: 40px;
            padding: 25px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .location-info h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .location-info h3 i {
            color: var(--accent-color);
        }

        .location-info p {
            margin-bottom: 15px;
            line-height: 1.7;
        }

        footer {
            text-align: center;
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            color: #6c757d;
            font-size: 0.9rem;
        }

        .loading {
            display: none;
            text-align: center;
            margin: 30px 0;
        }

        .spinner {
            border: 5px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 5px solid var(--primary-color);
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        .loading p {
            font-size: 1.1rem;
            color: var(--dark-color);
            font-weight: 500;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(3px);
            animation: fadeIn 0.3s ease-in-out;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 700px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            position: relative;
            animation: slideDown 0.4s ease-out;
        }

        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close {
            position: absolute;
            right: 25px;
            top: 20px;
            font-size: 28px;
            font-weight: bold;
            color: #6c757d;
            cursor: pointer;
            transition: var(--transition);
        }

        .close:hover {
            color: var(--danger-color);
            transform: rotate(90deg);
        }

        .upload-area {
            border: 3px dashed var(--primary-color);
            border-radius: var(--border-radius);
            padding: 50px 20px;
            text-align: center;
            margin: 30px 0;
            cursor: pointer;
            transition: var(--transition);
            background-color: rgba(74, 111, 165, 0.05);
        }

        .upload-area:hover {
            background-color: rgba(74, 111, 165, 0.1);
            transform: translateY(-3px);
        }

        .upload-area i {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .upload-area h3 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .upload-area p {
            color: var(--dark-color);
            font-size: 0.95rem;
        }

        .progress-container {
            margin: 30px 0;
            display: none;
        }

        .progress-container h4 {
            color: var(--dark-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            margin: 15px 0;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            border-radius: 5px;
            width: 0%;
            transition: width 0.5s ease;
        }

        .progress-text {
            text-align: center;
            color: var(--dark-color);
            font-weight: 500;
        }

        .feature-summary {
            max-height: 400px;
            overflow-y: auto;
            margin: 30px 0;
            padding: 20px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        .feature-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #eee;
            font-size: 0.95rem;
        }

        .feature-item span:first-child {
            font-weight: 600;
            color: var(--dark-color);
        }

        .feature-item span:last-child {
            font-family: 'Roboto Mono', monospace;
            color: var(--primary-color);
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            margin-left: 5px;
            color: var(--primary-color);
            cursor: pointer;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: var(--dark-color);
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            font-weight: normal;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        
        /* Add these new styles */
        .feature-actions {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .copy-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 8px 15px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .copy-btn:hover {
            background-color: var(--secondary-color);
        }
        
        .copy-btn i {
            font-size: 0.9rem;
        }
        
        .copied-notice {
            color: var(--success-color);
            font-size: 0.9rem;
            margin-left: 10px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .copied-notice.show {
            opacity: 1;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 992px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .input-section {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 95%;
                padding: 20px;
            }
        }

        @media (max-width: 768px) {
            .button-group {
                flex-direction: column;
            }
            
            .result-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .confidence {
                align-self: flex-start;
            }
            
            .modal-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>BioTrace: Microbiome Sample Origin Predictor</h1>
            <p class="subtitle">A tool for health practitioners to predict the body site origin (Mouth, Nasal, Skin, or Stool) of microbiome samples based on sequencing characteristics extracted from FastQ files</p>
        </header>

        <div class="model-info">
            <i class="fas fa-microscope"></i>
            <div class="model-info-content">
                <h3>About This Tool</h3>
                <p>This predictive model analyzes 27 sequencing features from microbiome samples to determine their most likely body site origin. The model uses a neural network trained on thousands of samples from different body sites.</p>
                <p><strong>Input Options:</strong> Enter values manually below or upload a FastQ file for automatic feature extraction.</p>
            </div>
        </div>

        <div class="input-section">
            <div>
                <div class="section-title">
                    <i class="fas fa-chart-bar"></i>
                    <h3>Read Statistics</h3>
                </div>
                <div class="input-group">
                    <label for="num_reads">Number of Reads <span class="tooltip">?<span class="tooltiptext">Total number of sequencing reads in the sample</span></span></label>
                    <input type="number" id="num_reads" step="any" placeholder="e.g., 150000">
                    <i class="fas fa-dna input-icon"></i>
                </div>
                <div class="input-group">
                    <label for="avg_read_length">Average Read Length <span class="tooltip">?<span class="tooltiptext">Average length of sequencing reads in base pairs</span></span></label>
                    <input type="number" id="avg_read_length" step="any" placeholder="e.g., 250">
                    <i class="fas fa-ruler input-icon"></i>
                </div>
                <div class="input-group">
                    <label for="std_read_length">Read Length Deviation <span class="tooltip">?<span class="tooltiptext">Standard deviation of read lengths</span></span></label>
                    <input type="number" id="std_read_length" step="any" placeholder="e.g., 15.2">
                    <i class="fas fa-project-diagram input-icon"></i>
                </div>
            </div>

            <div>
                <div class="section-title">
                    <i class="fas fa-percentage"></i>
                    <h3>GC Content</h3>
                </div>
                <div class="input-group">
                    <label for="avg_gc_content">Average GC Content <span class="tooltip">?<span class="tooltiptext">Proportion of G and C nucleotides (0-1)</span></span></label>
                    <input type="number" id="avg_gc_content" step="any" placeholder="e.g., 0.45" min="0" max="1">
                    <i class="fas fa-atom input-icon"></i>
                </div>
                <div class="input-group">
                    <label for="std_gc_content">GC Content Deviation <span class="tooltip">?<span class="tooltiptext">Standard deviation of GC content across reads</span></span></label>
                    <input type="number" id="std_gc_content" step="any" placeholder="e.g., 0.08" min="0" max="1">
                    <i class="fas fa-wave-square input-icon"></i>
                </div>
            </div>

            <div>
                <div class="section-title">
                    <i class="fas fa-star"></i>
                    <h3>Quality Metrics</h3>
                </div>
                <div class="input-group">
                    <label for="avg_quality">Average Quality Score <span class="tooltip">?<span class="tooltiptext">Average Phred quality score (typically 0-40)</span></span></label>
                    <input type="number" id="avg_quality" step="any" placeholder="e.g., 35">
                    <i class="fas fa-check-circle input-icon"></i>
                </div>
                <div class="input-group">
                    <label for="std_quality">Quality Score Deviation <span class="tooltip">?<span class="tooltiptext">Standard deviation of quality scores</span></span></label>
                    <input type="number" id="std_quality" step="any" placeholder="e.g., 5.5">
                    <i class="fas fa-sliders-h input-icon"></i>
                </div>
            </div>

            <div>
                <div class="section-title">
                    <i class="fas fa-dna"></i>
                    <h3>Nucleotide Composition</h3>
                </div>
                <div class="input-group">
                    <label for="A">A Nucleotide Proportion <span class="tooltip">?<span class="tooltiptext">Proportion of Adenine nucleotides (0-1)</span></span></label>
                    <input type="number" id="A" step="any" placeholder="e.g., 0.25" min="0" max="1">
                    <i class="fas fa-a input-icon"></i>
                </div>
                <div class="input-group">
                    <label for="T">T Nucleotide Proportion <span class="tooltip">?<span class="tooltiptext">Proportion of Thymine nucleotides (0-1)</span></span></label>
                    <input type="number" id="T" step="any" placeholder="e.g., 0.25" min="0" max="1">
                    <i class="fas fa-t input-icon"></i>
                </div>
                <div class="input-group">
                    <label for="G">G Nucleotide Proportion <span class="tooltip">?<span class="tooltiptext">Proportion of Guanine nucleotides (0-1)</span></span></label>
                    <input type="number" id="G" step="any" placeholder="e.g., 0.25" min="0" max="1">
                    <i class="fas fa-g input-icon"></i>
                </div>
                <div class="input-group">
                    <label for="C">C Nucleotide Proportion <span class="tooltip">?<span class="tooltiptext">Proportion of Cytosine nucleotides (0-1)</span></span></label>
                    <input type="number" id="C" step="any" placeholder="e.g., 0.25" min="0" max="1">
                    <i class="fas fa-c input-icon"></i>
                </div>
            </div>

            <div>
                <div class="section-title">
                    <i class="fas fa-code"></i>
                    <h3>K-mer Frequencies</h3>
                </div>
                <div class="input-group">
                    <label for="kmer_AA">AA Frequency <span class="tooltip">?<span class="tooltiptext">Frequency of AA dinucleotide in sample</span></span></label>
                    <input type="number" id="kmer_AA" step="any" placeholder="e.g., 0.06">
                </div>
                <div class="input-group">
                    <label for="kmer_AT">AT Frequency <span class="tooltip">?<span class="tooltiptext">Frequency of AT dinucleotide in sample</span></span></label>
                    <input type="number" id="kmer_AT" step="any" placeholder="e.g., 0.05">
                </div>
                <div class="input-group">
                    <label for="kmer_AG">AG Frequency <span class="tooltip">?<span class="tooltiptext">Frequency of AG dinucleotide in sample</span></span></label>
                    <input type="number" id="kmer_AG" step="any" placeholder="e.g., 0.06">
                </div>
                <div class="input-group">
                    <label for="kmer_AC">AC Frequency <span class="tooltip">?<span class="tooltiptext">Frequency of AC dinucleotide in sample</span></span></label>
                    <input type="number" id="kmer_AC" step="any" placeholder="e.g., 0.05">
                </div>
                <div class="input-group">
                    <label for="kmer_TA">TA Frequency <span class="tooltip">?<span class="tooltiptext">Frequency of TA dinucleotide in sample</span></span></label>
                    <input type="number" id="kmer_TA" step="any" placeholder="e.g., 0.06">
                </div>
                <div class="input-group">
                    <label for="kmer_TT">TT Frequency <span class="tooltip">?<span class="tooltiptext">Frequency of TT dinucleotide in sample</span></span></label>
                    <input type="number" id="kmer_TT" step="any" placeholder="e.g., 0.05">
                </div>
                <div class="input-group">
                    <label for="kmer_TG">TG Frequency <span class="tooltip">?<span class="tooltiptext">Frequency of TG dinucleotide in sample</span></span></label>
                    <input type="number" id="kmer_TG" step="any" placeholder="e.g., 0.06">
                </div>
                <div class="input-group">
                    <label for="kmer_TC">TC Frequency <span class="tooltip">?<span class="tooltiptext">Frequency of TC dinucleotide in sample</span></span></label>
                    <input type="number" id="kmer_TC" step="any" placeholder="e.g., 0.05">
                </div>
                <div class="input-group">
                    <label for="kmer_GA">GA Frequency <span class="tooltip">?<span class="tooltiptext">Frequency of GA dinucleotide in sample</span></span></label>
                    <input type="number" id="kmer_GA" step="any" placeholder="e.g., 0.06">
                </div>
                <div class="input-group">
                    <label for="kmer_GT">GT Frequency <span class="tooltip">?<span class="tooltiptext">Frequency of GT dinucleotide in sample</span></span></label>
                    <input type="number" id="kmer_GT" step="any" placeholder="e.g., 0.05">
                </div>
                <div class="input-group">
                    <label for="kmer_GG">GG Frequency <span class="tooltip">?<span class="tooltiptext">Frequency of GG dinucleotide in sample</span></span></label>
                    <input type="number" id="kmer_GG" step="any" placeholder="e.g., 0.06">
                </div>
                <div class="input-group">
                    <label for="kmer_GC">GC Frequency <span class="tooltip">?<span class="tooltiptext">Frequency of GC dinucleotide in sample</span></span></label>
                    <input type="number" id="kmer_GC" step="any" placeholder="e.g., 0.05">
                </div>
                <div class="input-group">
                    <label for="kmer_CA">CA Frequency <span class="tooltip">?<span class="tooltiptext">Frequency of CA dinucleotide in sample</span></span></label>
                    <input type="number" id="kmer_CA" step="any" placeholder="e.g., 0.06">
                </div>
                <div class="input-group">
                    <label for="kmer_CT">CT Frequency <span class="tooltip">?<span class="tooltiptext">Frequency of CT dinucleotide in sample</span></span></label>
                    <input type="number" id="kmer_CT" step="any" placeholder="e.g., 0.05">
                </div>
                <div class="input-group">
                    <label for="kmer_CG">CG Frequency <span class="tooltip">?<span class="tooltiptext">Frequency of CG dinucleotide in sample</span></span></label>
                    <input type="number" id="kmer_CG" step="any" placeholder="e.g., 0.06">
                </div>
                <div class="input-group">
                    <label for="kmer_CC">CC Frequency <span class="tooltip">?<span class="tooltiptext">Frequency of CC dinucleotide in sample</span></span></label>
                    <input type="number" id="kmer_CC" step="any" placeholder="e.g., 0.05">
                </div>
            </div>
        </div>

        <div class="button-group">
            <button class="fastq-btn" id="fastqBtn">
                <i class="fas fa-file-upload"></i> Upload FastQ File
            </button>
            <button class="predict-btn" id="predictBtn">
                <i class="fas fa-search"></i> Predict Location
            </button>
            <button class="reset-btn" id="resetBtn">
                <i class="fas fa-redo"></i> Reset Form
            </button>
        </div>

        <div class="loading" id="loadingIndicator">
            <div class="spinner"></div>
            <p>Analyzing sample data...</p>
        </div>

        <div class="results-section" id="resultsSection">
            <div class="result-header">
                <div>
                    <h2>Prediction Result</h2>
                    <div class="prediction-label" id="predictionLabel">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>Sample Origin</span>
                    </div>
                </div>
                <div class="confidence">
                    Confidence: <span class="confidence-value" id="confidenceValue">0%</span>
                </div>
            </div>

            <div class="probability-chart" id="probabilityChart">
                <div class="probability-bar">
                    <div class="probability-fill" id="mouthProb" style="width: 0%">Mouth: 0%</div>
                </div>
                <div class="probability-bar">
                    <div class="probability-fill" id="nasalProb" style="width: 0%">Nasal: 0%</div>
                </div>
                <div class="probability-bar">
                    <div class="probability-fill" id="skinProb" style="width: 0%">Skin: 0%</div>
                </div>
                <div class="probability-bar">
                    <div class="probability-fill" id="stoolProb" style="width: 0%">Stool: 0%</div>
                </div>
            </div>

            <div class="location-info" id="locationInfo">
                <h3><i class="fas fa-info-circle"></i> About This Location</h3>
                <p id="locationDescription">The prediction results will display detailed information about the most likely body site origin of your microbiome sample, including typical microbial composition and clinical significance.</p>
            </div>
        </div>

        <footer>
            <p>Microbiome Sample Origin Predictor | Designed for Health Practitioners </p>
            <p>This tool is intended for research purposes and should not be used as the sole basis for clinical decisions.</p>
        </footer>
    </div>

    <!-- FastQ Upload Modal -->
    <div id="fastqModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2><i class="fas fa-file-upload"></i> Upload FastQ File</h2>
            <p>Upload your microbiome sequencing file for automatic feature extraction and prediction.</p>
            
            <div class="upload-area" id="dropArea">
                <input type="file" id="fastqFileInput" accept=".fastq,.fq,.txt">
                <i class="fas fa-cloud-upload-alt"></i>
                <h3>Drag & Drop FastQ File Here</h3>
                <p>or click to browse your files</p>
                <p class="small">Supports .fastq, .fq, or .txt formats</p>
            </div>
            
            <div class="progress-container" id="progressContainer">
                <h4><i class="fas fa-spinner fa-spin"></i> Processing File...</h4>
                <div class="progress-bar">
                    <div class="progress" id="progressBar"></div>
                </div>
                <p class="progress-text" id="progressText">0%</p>
            </div>
            
           <div id="fastqResults" style="display: none;">
        <div class="feature-actions">
            <h3><i class="fas fa-table"></i> Extracted Features</h3>
            <div>
                <button class="copy-btn" id="copyFeaturesBtn">
                    <i class="far fa-copy"></i> Copy Features
                </button>
                <span class="copied-notice" id="copiedNotice">Copied!</span>
            </div>
        </div>
        <div class="feature-summary" id="featureSummary"></div>
        
        <div class="modal-actions">
            <button class="reset-btn" id="cancelFastq">
                <i class="fas fa-times"></i> Cancel
            </button>
            <button id="predictFromFastq" class="predict-btn">
                <i class="fas fa-search"></i> Predict from FastQ
            </button>
        </div>
    </div>
        </div>
    </div>

    <!-- Load TensorFlow.js -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.18.0/dist/tf.min.js"></script>
<script>
        // Global variables
        let model;
        let extractedFeatures = {};
        const locationInfo = {
            0: {
                name: "Mouth",
                icon: "fas fa-tooth",
                description: "The oral microbiome is diverse and includes bacteria that can tolerate the mechanical forces of chewing and the presence of saliva. Common genera include Streptococcus, Prevotella, and Veillonella. The mouth has distinct microbial communities in different niches like teeth, tongue, and gums. Oral microbiome composition has been linked to dental health, halitosis, and even systemic conditions like cardiovascular disease.",
                color: "#3a7bd5"
            },
            1: {
                name: "Nasal",
                icon: "fas fa-wind",
                description: "The nasal microbiome is less diverse than other body sites and is dominated by Corynebacterium, Staphylococcus, and Moraxella species. The nasal environment is relatively dry and exposed to frequent airflow, selecting for specific microbial adaptations. Nasal microbiome disturbances have been associated with conditions like chronic rhinosinusitis and may play a role in respiratory infections and allergies.",
                color: "#00d2ff"
            },
            2: {
                name: "Skin",
                icon: "fas fa-hand-paper",
                description: "Skin microbiota varies by skin site (dry, moist, oily areas) but commonly includes Staphylococcus, Corynebacterium, and Propionibacterium species. The skin's acidic pH, dryness, and exposure to the environment shape its microbial community. Skin microbiome imbalances are implicated in conditions like eczema, acne, and chronic wounds, and can affect wound healing outcomes.",
                color: "#4fc3f7"
            },
            3: {
                name: "Stool",
                icon: "fas fa-poop",
                description: "Gut microbiota is extremely diverse and dense, dominated by obligate anaerobes like Bacteroides, Firmicutes, and Bifidobacterium. The gut environment is nutrient-rich and anaerobic, supporting complex microbial ecosystems that play crucial roles in digestion, immunity, and even neurological function through the gut-brain axis. Gut microbiome alterations are associated with numerous conditions including IBD, IBS, obesity, and metabolic disorders.",
                color: "#28a745"
            }
        };

        // Standardization parameters
        const featureMeans = [
            1.43721431e+05, 2.69018750e+02, 2.37715517e-01, 5.42202649e-01,
            2.97212151e-02, 3.51530029e+01, 1.18246420e+00, 2.26679329e-01,
            2.31151467e-01, 2.94617043e-01, 2.47552161e-01, 5.67535948e-02,
            4.83669125e-02, 6.37325156e-02, 5.75477740e-02, 4.89627112e-02,
            5.93691223e-02, 6.87199146e-02, 5.30030652e-02, 6.84302630e-02,
            6.07770976e-02, 9.13640332e-02, 7.45372840e-02, 5.35279433e-02,
            6.20085512e-02, 7.10081972e-02, 6.18910203e-02
        ];

        const featureStds = [
            5.63597028e+05, 1.37583598e+02, 2.49698001e-01, 1.77398143e-02,
            7.37736961e-03, 1.54809375e+00, 2.62512900e-01, 3.28652678e-02,
            3.58909575e-02, 3.58972179e-02, 2.72986545e-02, 9.58774948e-03,
            6.15403134e-03, 9.34689409e-03, 1.06502024e-02, 6.74383902e-03,
            1.88470758e-02, 8.60577824e-03, 2.30272842e-02, 1.95423074e-02,
            8.68497993e-03, 2.33884013e-02, 4.78835626e-03, 6.99999122e-03,
            1.23388915e-02, 6.14531102e-03, 1.52695402e-02
        ];

        // Function to standardize input features
        function standardizeFeatures(rawFeatures) {
            return rawFeatures.map((value, index) => {
                if (featureStds[index] === 0) return 0; // Avoid division by zero
                return (value - featureMeans[index]) / featureStds[index];
            });
        }

        // DOM elements
        const predictBtn = document.getElementById('predictBtn');
        const resetBtn = document.getElementById('resetBtn');
        const fastqBtn = document.getElementById('fastqBtn');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const resultsSection = document.getElementById('resultsSection');
        const predictionLabel = document.getElementById('predictionLabel');
        const confidenceValue = document.getElementById('confidenceValue');
        const mouthProb = document.getElementById('mouthProb');
        const nasalProb = document.getElementById('nasalProb');
        const skinProb = document.getElementById('skinProb');
        const stoolProb = document.getElementById('stoolProb');
        const locationDescription = document.getElementById('locationDescription');
        const probabilityChart = document.getElementById('probabilityChart');

        // FASTQ modal elements
        const fastqModal = document.getElementById('fastqModal');
        const closeModal = document.querySelector('.close');
        const dropArea = document.getElementById('dropArea');
        const fastqFileInput = document.getElementById('fastqFileInput');
        const progressContainer = document.getElementById('progressContainer');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const fastqResults = document.getElementById('fastqResults');
        const featureSummary = document.getElementById('featureSummary');
        const predictFromFastq = document.getElementById('predictFromFastq');
        const cancelFastq = document.getElementById('cancelFastq');

        // Initialize the application
        async function init() {
            await loadModel();
            setupEventListeners();
            setupFastQHandlers();
            addSampleDataButton();
        }

        function addSampleDataButton() {
            const buttonGroup = document.querySelector('.button-group');
            const demoBtn = document.createElement('button');
            demoBtn.className = 'reset-btn';
            demoBtn.innerHTML = '<i class="fas fa-flask"></i> Load Sample Data';
            demoBtn.id = 'demoBtn';
            demoBtn.style.marginRight = 'auto';
            buttonGroup.insertBefore(demoBtn, buttonGroup.firstChild);
            
            demoBtn.addEventListener('click', fillSampleData);
        }

        function fillSampleData() {
            // Raw sample data (mouth example)
            const rawSampleData = {
                num_reads: 21599,
                avg_read_length: 400.0,
                std_read_length: 0.0,
                avg_gc_content: 0.528146,
                std_gc_content: 0.017448,
                avg_quality: 36.89856,
                std_quality: 1.011901,
                A: 0.279865,
                T: 0.191989,
                G: 0.305681,
                C: 0.222465,
                kmer_AA: 0.074917,
                kmer_AT: 0.057997,
                kmer_AG: 0.078656,
                kmer_AC: 0.068733,
                kmer_TA: 0.048611,
                kmer_TT: 0.039604,
                kmer_TG: 0.06632,
                kmer_TC: 0.037548,
                kmer_GA: 0.095237,
                kmer_GT: 0.048019,
                kmer_GG: 0.098694,
                kmer_GC: 0.064213,
                kmer_CA: 0.061733,
                kmer_CT: 0.046844,
                kmer_CG: 0.060346,
                kmer_CC: 0.052528
            };

            // Fill the form with raw values
            document.getElementById('num_reads').value = rawSampleData.num_reads;
            document.getElementById('avg_read_length').value = rawSampleData.avg_read_length;
            document.getElementById('std_read_length').value = rawSampleData.std_read_length;
            document.getElementById('avg_gc_content').value = rawSampleData.avg_gc_content;
            document.getElementById('std_gc_content').value = rawSampleData.std_gc_content;
            document.getElementById('avg_quality').value = rawSampleData.avg_quality;
            document.getElementById('std_quality').value = rawSampleData.std_quality;
            document.getElementById('A').value = rawSampleData.A;
            document.getElementById('T').value = rawSampleData.T;
            document.getElementById('G').value = rawSampleData.G;
            document.getElementById('C').value = rawSampleData.C;
            document.getElementById('kmer_AA').value = rawSampleData.kmer_AA;
            document.getElementById('kmer_AT').value = rawSampleData.kmer_AT;
            document.getElementById('kmer_AG').value = rawSampleData.kmer_AG;
            document.getElementById('kmer_AC').value = rawSampleData.kmer_AC;
            document.getElementById('kmer_TA').value = rawSampleData.kmer_TA;
            document.getElementById('kmer_TT').value = rawSampleData.kmer_TT;
            document.getElementById('kmer_TG').value = rawSampleData.kmer_TG;
            document.getElementById('kmer_TC').value = rawSampleData.kmer_TC;
            document.getElementById('kmer_GA').value = rawSampleData.kmer_GA;
            document.getElementById('kmer_GT').value = rawSampleData.kmer_GT;
            document.getElementById('kmer_GG').value = rawSampleData.kmer_GG;
            document.getElementById('kmer_GC').value = rawSampleData.kmer_GC;
            document.getElementById('kmer_CA').value = rawSampleData.kmer_CA;
            document.getElementById('kmer_CT').value = rawSampleData.kmer_CT;
            document.getElementById('kmer_CG').value = rawSampleData.kmer_CG;
            document.getElementById('kmer_CC').value = rawSampleData.kmer_CC;
            
            showNotification('Sample microbiome data loaded. Click "Predict Location" to analyze.', 'success');
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                ${message}
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 5000);
        }

        async function loadModel() {
            try {
                const modelInfo = document.querySelector('.model-info');
                const originalContent = modelInfo.innerHTML;
                modelInfo.innerHTML = `
                    <i class="fas fa-spinner fa-spin"></i>
                    <div class="model-info-content">
                        <h3>Loading Prediction Model</h3>
                        <p>Please wait while we load the microbiome analysis model...</p>
                    </div>
                `;
                
                model = await tf.loadGraphModel('tfjs/model.json');
                
                modelInfo.innerHTML = originalContent;
                showNotification('Prediction model loaded and ready for analysis.', 'success');
                console.log('Model loaded successfully');
            } catch (error) {
                console.error('Error loading model:', error);
                showNotification('Error loading the prediction model. Please try again later.', 'error');
            }
        }

        function setupEventListeners() {
            predictBtn.addEventListener('click', handlePrediction);
            resetBtn.addEventListener('click', resetForm);
            fastqBtn.addEventListener('click', () => {
                fastqModal.style.display = 'block';
                fastqResults.style.display = 'none';
                progressContainer.style.display = 'none';
            });
        }

        function setupFastQHandlers() {
            closeModal.addEventListener('click', () => fastqModal.style.display = 'none');
            cancelFastq.addEventListener('click', () => fastqModal.style.display = 'none');
            window.addEventListener('click', (e) => {
                if (e.target === fastqModal) fastqModal.style.display = 'none';
            });

            fastqFileInput.addEventListener('change', handleFileSelect);
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });
            
            dropArea.addEventListener('drop', handleDrop, false);
            predictFromFastq.addEventListener('click', predictFromExtractedFeatures);
        }

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        function highlight() {
            dropArea.style.backgroundColor = 'rgba(58, 123, 213, 0.1)';
            dropArea.style.borderColor = 'var(--secondary-color)';
        }

        function unhighlight() {
            dropArea.style.backgroundColor = 'rgba(74, 111, 165, 0.05)';
            dropArea.style.borderColor = 'var(--primary-color)';
        }

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            if (files.length) {
                fastqFileInput.files = files;
                handleFileSelect({ target: fastqFileInput });
            }
        }

        async function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.name.match(/\.(fastq|fq|txt)$/i)) {
                showNotification('Please upload a valid FastQ file (.fastq, .fq, or .txt)', 'error');
                return;
            }
            
            progressContainer.style.display = 'block';
            fastqResults.style.display = 'none';
            progressBar.style.width = '0%';
            progressText.textContent = '0%';
            
            try {
                await processFastQFile(file);
                displayExtractedFeatures();
                fastqResults.style.display = 'block';
                showNotification('FastQ file processed successfully. Features extracted.', 'success');
            } catch (error) {
                console.error('Error processing FastQ file:', error);
                showNotification('Error processing FastQ file. Please check the file format.', 'error');
            } finally {
                progressContainer.style.display = 'none';
            }
        }

        async function processFastQFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onprogress = (e) => {
                    if (e.lengthComputable) {
                        const percentLoaded = Math.round((e.loaded / e.total) * 100);
                        progressBar.style.width = `${percentLoaded}%`;
                        progressText.textContent = `${percentLoaded}%`;
                        updateProgress(`Uploading file... ${percentLoaded}%`);
                    }
                };
                
                reader.onload = async (e) => {
                    try {
                        const content = e.target.result;
                        updateProgress('Analyzing reads...');
                        extractedFeatures = await extractFeaturesFromFastQ(content);
                        resolve();
                    } catch (error) {
                        reject(error);
                    }
                };
                
                reader.onerror = () => {
                    reject(new Error('Error reading file'));
                };
                
                reader.readAsText(file);
            });
        }

        async function extractFeaturesFromFastQ(content) {
            const lines = content.split('\n');
            const reads = [];
            
            for (let i = 0; i < 100; i += 20) {
                updateProgress(`Processing reads... ${i}%`);
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            for (let i = 0; i < lines.length; i += 4) {
                if (lines[i].startsWith('@') && lines[i+2] === '+') {
                    const sequence = lines[i+1];
                    const quality = lines[i+3];
                    reads.push({ sequence, quality });
                }
            }
            
            updateProgress(`Processing ${reads.length} reads...`);
            
            const num_reads = reads.length;
            const read_lengths = reads.map(r => r.sequence.length);
            const avg_read_length = read_lengths.reduce((a, b) => a + b, 0) / num_reads;
            const std_read_length = Math.sqrt(read_lengths.map(x => Math.pow(x - avg_read_length, 2)).reduce((a, b) => a + b, 0) / num_reads);
            
            const gc_contents = reads.map(r => {
                const gc = (r.sequence.match(/[GC]/gi) || []).length;
                return gc / r.sequence.length;
            });
            const avg_gc_content = gc_contents.reduce((a, b) => a + b, 0) / num_reads;
            const std_gc_content = Math.sqrt(gc_contents.map(x => Math.pow(x - avg_gc_content, 2)).reduce((a, b) => a + b, 0) / num_reads);
            
            const avg_qualities = reads.map(r => {
                return Array.from(r.quality).reduce((sum, char) => sum + (char.charCodeAt(0) - 33), 0) / r.quality.length;
            });
            const avg_quality = avg_qualities.reduce((a, b) => a + b, 0) / num_reads;
            const std_quality = Math.sqrt(avg_qualities.map(x => Math.pow(x - avg_quality, 2)).reduce((a, b) => a + b, 0) / num_reads);
            
            const all_sequences = reads.map(r => r.sequence).join('');
            const total_bases = all_sequences.length;
            const A = (all_sequences.match(/A/gi) || []).length / total_bases;
            const T = (all_sequences.match(/T/gi) || []).length / total_bases;
            const G = (all_sequences.match(/G/gi) || []).length / total_bases;
            const C = (all_sequences.match(/C/gi) || []).length / total_bases;
            
            const kmers = {};
            const kmerKeys = ['AA', 'AT', 'AG', 'AC', 'TA', 'TT', 'TG', 'TC', 
                             'GA', 'GT', 'GG', 'GC', 'CA', 'CT', 'CG', 'CC'];
            
            kmerKeys.forEach(k => kmers[`kmer_${k}`] = 0);
            
            let totalKmers = 0;
            for (const read of reads) {
                const seq = read.sequence.toUpperCase();
                for (let i = 0; i < seq.length - 1; i++) {
                    const kmer = seq.substr(i, 2);
                    if (kmerKeys.includes(kmer)) {
                        kmers[`kmer_${kmer}`]++;
                        totalKmers++;
                    }
                }
            }
            
            kmerKeys.forEach(k => {
                kmers[`kmer_${k}`] = totalKmers > 0 ? kmers[`kmer_${k}`] / totalKmers : 0;
            });
            
            return {
                num_reads,
                avg_read_length,
                std_read_length,
                avg_gc_content,
                std_gc_content,
                avg_quality,
                std_quality,
                A, T, G, C,
                ...kmers
            };
        }

        function displayExtractedFeatures() {
            featureSummary.innerHTML = '';
            let featuresText = '';
            
            for (const [key, value] of Object.entries(extractedFeatures)) {
                const div = document.createElement('div');
                div.className = 'feature-item';
                
                const nameSpan = document.createElement('span');
                nameSpan.textContent = key.replace(/_/g, ' ');
                nameSpan.style.fontWeight = '600';
                
                const valueSpan = document.createElement('span');
                const formattedValue = typeof value === 'number' ? value.toFixed(6) : value;
                valueSpan.textContent = formattedValue;
                
                div.appendChild(nameSpan);
                div.appendChild(valueSpan);
                featureSummary.appendChild(div);
                
                featuresText += `${key.replace(/_/g, ' ')}: ${formattedValue}\n`;
            }
            
            featureSummary.dataset.featuresText = featuresText;
            
            const copyBtn = document.getElementById('copyFeaturesBtn');
            const copiedNotice = document.getElementById('copiedNotice');
            
            copyBtn.addEventListener('click', () => {
                navigator.clipboard.writeText(featuresText).then(() => {
                    copiedNotice.classList.add('show');
                    setTimeout(() => {
                        copiedNotice.classList.remove('show');
                    }, 2000);
                }).catch(err => {
                    console.error('Failed to copy features: ', err);
                    alert('Failed to copy features to clipboard. Please try again.');
                });
            });
            
            setTimeout(() => {
                predictFromExtractedFeatures();
            }, 500);
        }

        async function predictFromExtractedFeatures() {
            if (!extractedFeatures || Object.keys(extractedFeatures).length === 0) {
                showNotification('No features extracted yet. Please upload a FastQ file first.', 'error');
                return;
            }
            
            progressContainer.style.display = 'block';
            progressBar.style.width = '100%';
            progressText.textContent = 'Making prediction...';
            
            try {
                const rawValues = [
                    extractedFeatures.num_reads,
                    extractedFeatures.avg_read_length,
                    extractedFeatures.std_read_length,
                    extractedFeatures.avg_gc_content,
                    extractedFeatures.std_gc_content,
                    extractedFeatures.avg_quality,
                    extractedFeatures.std_quality,
                    extractedFeatures.A,
                    extractedFeatures.T,
                    extractedFeatures.G,
                    extractedFeatures.C,
                    extractedFeatures.kmer_AA,
                    extractedFeatures.kmer_AT,
                    extractedFeatures.kmer_AG,
                    extractedFeatures.kmer_AC,
                    extractedFeatures.kmer_TA,
                    extractedFeatures.kmer_TT,
                    extractedFeatures.kmer_TG,
                    extractedFeatures.kmer_TC,
                    extractedFeatures.kmer_GA,
                    extractedFeatures.kmer_GT,
                    extractedFeatures.kmer_GG,
                    extractedFeatures.kmer_GC,
                    extractedFeatures.kmer_CA,
                    extractedFeatures.kmer_CT,
                    extractedFeatures.kmer_CG,
                    extractedFeatures.kmer_CC
                ];
                
                const standardizedValues = standardizeFeatures(rawValues);
                const inputTensor = tf.tensor2d([standardizedValues]);
                const prediction = model.predict(inputTensor);
                const predictionData = await prediction.data();
                
                const predictedClass = predictionData.indexOf(Math.max(...predictionData));
                const confidence = Math.max(...predictionData) * 100;
                
                fastqModal.style.display = 'none';
                displayResults(predictedClass, confidence, predictionData);
                
                showNotification('Prediction completed successfully!', 'success');
                
                inputTensor.dispose();
                prediction.dispose();
            } catch (error) {
                console.error('Prediction error:', error);
                showNotification('An error occurred during prediction.', 'error');
            } finally {
                progressContainer.style.display = 'none';
            }
        }

        async function handlePrediction() {
            if (!validateInputs()) {
                return;
            }

            loadingIndicator.style.display = 'block';
            resultsSection.style.display = 'none';

            try {
                const rawValues = getRawInputValues();
                const standardizedValues = standardizeFeatures(rawValues);
                const inputTensor = tf.tensor2d([standardizedValues]);
                const prediction = model.predict(inputTensor);
                const predictionData = await prediction.data();
                
                const predictedClass = predictionData.indexOf(Math.max(...predictionData));
                const confidence = Math.max(...predictionData) * 100;
                
                displayResults(predictedClass, confidence, predictionData);
                
                showNotification('Prediction completed successfully!', 'success');
                
                inputTensor.dispose();
                prediction.dispose();
            } catch (error) {
                console.error('Prediction error:', error);
                showNotification('An error occurred during prediction. Please try again.', 'error');
            } finally {
                loadingIndicator.style.display = 'none';
            }
        }

        function getRawInputValues() {
            return [
                parseFloat(document.getElementById('num_reads').value) || 0,
                parseFloat(document.getElementById('avg_read_length').value) || 0,
                parseFloat(document.getElementById('std_read_length').value) || 0,
                parseFloat(document.getElementById('avg_gc_content').value) || 0,
                parseFloat(document.getElementById('std_gc_content').value) || 0,
                parseFloat(document.getElementById('avg_quality').value) || 0,
                parseFloat(document.getElementById('std_quality').value) || 0,
                parseFloat(document.getElementById('A').value) || 0,
                parseFloat(document.getElementById('T').value) || 0,
                parseFloat(document.getElementById('G').value) || 0,
                parseFloat(document.getElementById('C').value) || 0,
                parseFloat(document.getElementById('kmer_AA').value) || 0,
                parseFloat(document.getElementById('kmer_AT').value) || 0,
                parseFloat(document.getElementById('kmer_AG').value) || 0,
                parseFloat(document.getElementById('kmer_AC').value) || 0,
                parseFloat(document.getElementById('kmer_TA').value) || 0,
                parseFloat(document.getElementById('kmer_TT').value) || 0,
                parseFloat(document.getElementById('kmer_TG').value) || 0,
                parseFloat(document.getElementById('kmer_TC').value) || 0,
                parseFloat(document.getElementById('kmer_GA').value) || 0,
                parseFloat(document.getElementById('kmer_GT').value) || 0,
                parseFloat(document.getElementById('kmer_GG').value) || 0,
                parseFloat(document.getElementById('kmer_GC').value) || 0,
                parseFloat(document.getElementById('kmer_CA').value) || 0,
                parseFloat(document.getElementById('kmer_CT').value) || 0,
                parseFloat(document.getElementById('kmer_CG').value) || 0,
                parseFloat(document.getElementById('kmer_CC').value) || 0
            ];
        }

        function validateInputs() {
            const requiredInputs = document.querySelectorAll('input[type="number"]');
            let isValid = true;
            
            for (let input of requiredInputs) {
                if (input.value === '') {
                    input.style.borderColor = 'var(--danger-color)';
                    isValid = false;
                    
                    if (!input.nextElementSibling || !input.nextElementSibling.classList.contains('error-message')) {
                        const errorMsg = document.createElement('div');
                        errorMsg.className = 'error-message';
                        errorMsg.style.color = 'var(--danger-color)';
                        errorMsg.style.fontSize = '0.8rem';
                        errorMsg.style.marginTop = '5px';
                        errorMsg.textContent = 'This field is required';
                        input.parentNode.insertBefore(errorMsg, input.nextElementSibling);
                    }
                } else {
                    input.style.borderColor = '#e0e0e0';
                    
                    if (input.nextElementSibling && input.nextElementSibling.classList.contains('error-message')) {
                        input.parentNode.removeChild(input.nextElementSibling);
                    }
                    
                    if (['A', 'T', 'G', 'C'].includes(input.id)) {
                        const value = parseFloat(input.value);
                        if (value < 0 || value > 1) {
                            input.style.borderColor = 'var(--danger-color)';
                            const errorMsg = document.createElement('div');
                            errorMsg.className = 'error-message';
                            errorMsg.style.color = 'var(--danger-color)';
                            errorMsg.style.fontSize = '0.8rem';
                            errorMsg.style.marginTop = '5px';
                            errorMsg.textContent = 'Value must be between 0 and 1';
                            input.parentNode.insertBefore(errorMsg, input.nextElementSibling);
                            isValid = false;
                        }
                    }
                }
            }
            
            if (!isValid) {
                showNotification('Please fill in all required fields with valid values.', 'error');
                document.querySelector('.input-group input[type="number"]').focus();
            }
            
            return isValid;
        }

        function displayResults(predictedClass, confidence, predictionData) {
            resultsSection.style.display = 'block';
            const location = locationInfo[predictedClass];
            predictionLabel.innerHTML = `<i class="${location.icon}"></i> <span>${location.name}</span>`;
            predictionLabel.style.color = location.color;
            confidenceValue.textContent = `${confidence.toFixed(1)}%`;
            
            updateProbabilityBars(predictionData);
            locationDescription.textContent = location.description;
            resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function updateProbabilityBars(predictionData) {
            const mouthProbValue = predictionData[0] * 100;
            setTimeout(() => {
                mouthProb.style.width = `${mouthProbValue}%`;
                mouthProb.textContent = `Mouth: ${mouthProbValue.toFixed(1)}%`;
                mouthProb.style.background = `linear-gradient(to right, ${locationInfo[0].color}, ${shadeColor(locationInfo[0].color, 20)})`;
            }, 100);
            
            const nasalProbValue = predictionData[1] * 100;
            setTimeout(() => {
                nasalProb.style.width = `${nasalProbValue}%`;
                nasalProb.textContent = `Nasal: ${nasalProbValue.toFixed(1)}%`;
                nasalProb.style.background = `linear-gradient(to right, ${locationInfo[1].color}, ${shadeColor(locationInfo[1].color, 20)})`;
            }, 200);
            
            const skinProbValue = predictionData[2] * 100;
            setTimeout(() => {
                skinProb.style.width = `${skinProbValue}%`;
                skinProb.textContent = `Skin: ${skinProbValue.toFixed(1)}%`;
                skinProb.style.background = `linear-gradient(to right, ${locationInfo[2].color}, ${shadeColor(locationInfo[2].color, 20)})`;
            }, 300);
            
            const stoolProbValue = predictionData[3] * 100;
            setTimeout(() => {
                stoolProb.style.width = `${stoolProbValue}%`;
                stoolProb.textContent = `Stool: ${stoolProbValue.toFixed(1)}%`;
                stoolProb.style.background = `linear-gradient(to right, ${locationInfo[3].color}, ${shadeColor(locationInfo[3].color, 20)})`;
            }, 400);
        }

        function shadeColor(color, percent) {
            let R = parseInt(color.substring(1,3), 16);
            let G = parseInt(color.substring(3,5), 16);
            let B = parseInt(color.substring(5,7), 16);

            R = parseInt(R * (100 + percent) / 100);
            G = parseInt(G * (100 + percent) / 100);
            B = parseInt(B * (100 + percent) / 100);

            R = (R<255)?R:255;  
            G = (G<255)?G:255;  
            B = (B<255)?B:255;  

            const RR = ((R.toString(16).length===1)?"0"+R.toString(16):R.toString(16));
            const GG = ((G.toString(16).length===1)?"0"+G.toString(16):G.toString(16));
            const BB = ((B.toString(16).length===1)?"0"+B.toString(16):B.toString(16));

            return "#"+RR+GG+BB;
        }

        function resetForm() {
            document.querySelectorAll('input[type="number"]').forEach(input => {
                input.value = '';
                input.style.borderColor = '#e0e0e0';
                
                if (input.nextElementSibling && input.nextElementSibling.classList.contains('error-message')) {
                    input.parentNode.removeChild(input.nextElementSibling);
                }
            });
            
            resultsSection.style.display = 'none';
            showNotification('Form has been reset.', 'success');
        }

        function updateProgress(message) {
            progressText.textContent = message;
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>

    <style>
        /* Notification styles */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: var(--border-radius);
            color: white;
            font-weight: 500;
            box-shadow: var(--box-shadow);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .notification.success {
            background-color: var(--success-color);
        }
        
        .notification.error {
            background-color: var(--danger-color);
        }
        
        .notification i {
            font-size: 1.2rem;
        }
    </style>
</body>
</html>
